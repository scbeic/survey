<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>LIFF Flex Demo</title>
  <style>
    body{font-family:sans-serif;background:#f0f0f0;
         margin:0;padding:32px;display:flex;justify-content:center;align-items:center;min-height:100vh}
    .card{background:#fff;border-radius:12px;max-width:420px;width:100%;padding:24px;
          box-shadow:0 4px 12px rgba(0,0,0,.1);text-align:center}
    .status{margin-top:20px;padding:12px;border-radius:6px;font-weight:bold}
    .loading{background:#e3f2fd;color:#1976d2}
    .success{background:#e8f5e8;color:#2e7d32}
    .error{background:#ffebee;color:#c62828}
    .spinner{border:3px solid #eee;border-top:3px solid #00B900;border-radius:50%;
             width:28px;height:28px;animation:spin 1s linear infinite;margin:0 auto 12px}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="card">
    <h2>LIFF Flex Demo</h2>
    <div id="status" class="status loading">
      <div class="spinner"></div>
      ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î LIFF...
    </div>
  </div>

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/versions/2.22.3/liff.js"></script>
  <script>
    const status = document.getElementById('status');

    /** -------- Flex Template -------- */
    const flexTemplate = (name) => ({
      type: 'flex',
      altText: '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏à‡∏≤‡∏Å LIFF',
      contents: {
        type: 'bubble',
        header: {
          type: 'box',
          layout: 'vertical',
          contents:[{type:'text',text:'üëã ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ '+name+'!',weight:'bold',size:'xl',color:'#ffffff'}],
          backgroundColor:'#00B900',
          paddingAll:'20px'
        },
        body:{
          type:'box',
          layout:'vertical',
          contents:[{type:'text',text:'‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ Flex Message ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏à‡∏≤‡∏Å LIFF ‚úÖ',wrap:true}]
        },
        footer:{
          type:'box',
          layout:'vertical',
          contents:[{
            type:'button',
            style:'primary',
            color:'#00B900',
            action:{type:'uri',label:'‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå',uri:'https://line.me'}
          }]
        }
      }
    });

    /** -------- LIFF Flow -------- */
    async function initLIFF() {
      try {
        const liffId = '1657155025-mN3yQKNW';           // ‚Üê ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        status.innerHTML = '<div class="spinner"></div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE...';
        await liff.init({ liffId });

        /* ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE in-app browser ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô */
        if (!liff.isInClient()) {
          status.className = 'status error';
          status.textContent = '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏≤‡∏Å‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ LINE ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô';
          return;
        }

        const profile = await liff.getProfile();
        const flex = flexTemplate(profile.displayName);

        status.innerHTML = '<div class="spinner"></div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á Flex...';
        await liff.sendMessages([flex]);

        status.className = 'status success';
        status.textContent = '‚úÖ ‡∏™‡πà‡∏á Flex ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡∏à‡∏∞‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÉ‡∏ô 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ';

        setTimeout(() => liff.closeWindow(), 2000);
      } catch (err) {
        console.error(err);
        status.className = 'status error';
        status.textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: '+err.message;
      }
    }

    window.addEventListener('load', () => {
      if (typeof liff === 'undefined') {
        status.className = 'status error';
        status.textContent = '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö LIFF SDK; ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ LINE';
      } else {
        initLIFF();
      }
    });
  </script>
</body>
</html>

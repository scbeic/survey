<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>LIFF Flex Demo</title>
  <style>
    body { font-family: sans-serif; background: #f0f0f0; margin: 0; padding: 32px; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
    .card { background: #fff; border-radius: 12px; max-width: 420px; width: 100%; padding: 24px; box-shadow: 0 4px 12px rgba(0,0,0,.1); text-align: center; }
    .status { margin-top: 20px; padding: 12px; border-radius: 6px; font-weight: bold; }
    .loading { background: #e3f2fd; color: #1976d2; }
    .success { background: #e8f5e8; color: #2e7d32; }
    .error { background: #ffebee; color: #c62828; }
    .spinner { border: 3px solid #eee; border-top: 3px solid #00B900; border-radius: 50%; width: 28px; height: 28px; animation: spin 1s linear infinite; margin: 0 auto 12px; }
    @keyframes spin { 0% { transform: rotate(0); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="card">
    <h2>LINE LIFF Flex Message</h2>
    <div id="status" class="status loading">
      <div class="spinner"></div>
      ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î LIFF SDK...
    </div>
  </div>

  <!-- ‚úÖ ‡πÇ‡∏´‡∏•‡∏î SDK ‡πÅ‡∏ö‡∏ö‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ -->
  <script>
    const script = document.createElement('script');
    script.src = 'https://static.line-scdn.net/liff/edge/versions/2.22.3/liff.js';
    script.onload = () => {
      runLIFF(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ liff.js ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
    };
    script.onerror = () => {
      document.getElementById("status").className = "status error";
      document.getElementById("status").innerText = "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î LIFF SDK ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ LINE";
    };
    document.head.appendChild(script);
  </script>

  <script>
    function runLIFF() {
      const status = document.getElementById("status");

      const createFlex = (name) => ({
        type: 'flex',
        altText: '‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢‡∏à‡∏≤‡∏Å LIFF',
        contents: {
          type: 'bubble',
          header: {
            type: 'box',
            layout: 'vertical',
            contents: [{ type: 'text', text: `üëã ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ${name}`, weight: 'bold', size: 'xl', color: '#ffffff' }],
            backgroundColor: '#00B900',
            paddingAll: '20px'
          },
          body: {
            type: 'box',
            layout: 'vertical',
            contents: [{ type: 'text', text: '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ Flex Message ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏à‡∏≤‡∏Å LIFF', wrap: true }]
          },
          footer: {
            type: 'box',
            layout: 'vertical',
            contents: [
              {
                type: 'button',
                style: 'primary',
                color: '#00B900',
                action: {
                  type: 'uri',
                  label: '‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå',
                  uri: 'https://line.me'
                }
              }
            ]
          }
        }
      });

      liff.init({ liffId: 'YOUR_LIFF_ID' }) // ‚Üê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        .then(() => {
          if (!liff.isInClient()) {
            status.className = 'status error';
            status.innerText = '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏≤‡∏Å‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ LINE ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô';
            return;
          }
          return liff.getProfile();
        })
        .then(profile => {
          const flex = createFlex(profile.displayName);
          status.innerHTML = '<div class="spinner"></div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á Flex...';
          return liff.sendMessages([flex]);
        })
        .then(() => {
          status.className = 'status success';
          status.innerText = '‚úÖ ‡∏™‡πà‡∏á Flex ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÉ‡∏ô 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ';
          setTimeout(() => liff.closeWindow(), 2000);
        })
        .catch(err => {
          console.error('LIFF error:', err);
          status.className = 'status error';
          status.innerText = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message;
        });
    }
  </script>
</body>
</html>
